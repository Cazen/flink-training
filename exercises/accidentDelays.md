---
layout: page
title: DataStream API - Accident Delays
permalink: /exercises/accidentDelays.html
---

The task of the "Accident Delays" exercise is to identify taxi rides that might have been delayed by traffic accidents. For this purpose, two data streams, a stream of taxi rides and a stream of accident reports, are connected. For simplicity, we assume that the taxi rides travel on the direct connection between their start and end location. 
The `GeoUtils` class provides a method `GeoUtils.mapToGridCellsOnWay()` which returns a list of all grid cell ids on the direct connection of two locations. The goal of the exercise is to send one notification for each grid cell that was on the way of a ride and on which an accident was reported during the ride (after its start and before its end).

### Input Data

The first input data stream of this exercise is a stream of `TaxiRide` records generated by the [Taxi Stream generator]({{ site.baseurl }}/exercises/taxiData.html) filtered by the New York City area filter of the [Taxi Ride Cleansing exercise]({{ site.baseurl }}/exercises/rideCleansing.html) (reuse the FilterFunction of the Taxi Ride Cleansing exercise).

The second input data stream is a `DataStream<Accident>` which randomly reports accidents and their clearance within the New York City area. Two records are emitted for each accident, a start and an end record. Both record types can be distinguished by the `Accidents.isCleared` field which is set to `true` if the accident was cleared.

The generator is used as follows:

{% highlight java %}
// get an ExecutionEnvironment
StreamExecutionEnvironment env = 
  StreamExecutionEnvironment.getExecutionEnvironment();

// add an accidents generator
DataStream<Accident> accidents = env
	.addSource(new AccidentGenerator(servingSpeedFactor);
{% endhighlight %}

### Expected Output

The result of the exercise should be a `DataStream<Tuple2<Integer, TaxiRide>>` where the first field is the id of the cell in which an accident happened while the ride (second field) was passing.

The result stream can be written to standard out, Kafka, or to a file.

### Implementation Hints

#### Program Structure

**TODO**

#### Mapping Taxi Rides to Grid Cells

**TODO**

#### Partitioning Taxi Rides and Accidents

**TODO**

#### Identifying Delayed Taxi Rides

**TODO**

### Reference Solution

Reference solutions are available at GitHub:

- Java: [AccidentDelays.java](https://github.com/dataArtisans/flink-training/blob/master/flink-exercises/src/main/java/com/dataArtisans/flinkTraining/exercises/dataStreamJava/accidentDelays/AccidentDelays.java)
